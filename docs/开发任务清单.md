# KTSP 开发任务清单

## 模块分配

### 开发者 A（场地/预约方向）

| 模块 | 用户端 | 管理后台 | API |
|------|:------:|:-------:|:---:|
| 场地管理 | `/venues` | `/admin/venues` | `/api/admin/venues` |
| 场地预约 | `/booking`, `/bookings` | `/admin/bookings` | `/api/admin/bookings` |
| 预约评价 | `/bookings/[id]/review` | - | `/api/reviews` |
| 意见反馈 | `/feedback` | - | `/api/feedback` |
| 数据报表 | - | `/admin/stats` | `/api/admin/stats` |

### 开发者 B（教练/会员/营销方向）

| 模块 | 用户端 | 管理后台 | API |
|------|:------:|:-------:|:---:|
| 教练管理 | `/coaches` | `/admin/coaches` | `/api/admin/coaches` |
| 团体课程 | `/courses` | - | `/api/courses` |
| 会员管理 | `/profile`, `/settings` | `/admin/members` | `/api/admin/members` |
| 积分商城 | `/points`, `/checkin` | `/admin/products`, `/admin/points` | `/api/admin/products` |
| 优惠券 | `/coupons` | `/admin/coupons` | `/api/admin/coupons` |
| 消息/推荐 | `/messages`, `/referral` | - | `/api/messages`, `/api/referral` |

---

## 开发者 A 详细任务

### 模块 1: 场地管理 ⭐ 优先

#### 用户端（已完成前端，需完善）
- [ ] `GET /api/venues` - 场地列表 ✅ 已实现
- [ ] `GET /api/venues/[id]` - 场地详情 ✅ 已实现
- [ ] `GET /api/venues/[id]/slots` - 可用时段 ✅ 已实现

#### 管理后台（需开发）
- [ ] `GET /api/admin/venues` - 场地列表（含分页、筛选）
- [ ] `POST /api/admin/venues` - 新增场地
- [ ] `PUT /api/admin/venues/[id]` - 编辑场地
- [ ] `DELETE /api/admin/venues/[id]` - 删除场地
- [ ] `PUT /api/admin/venues/[id]/status` - 修改状态（维护/营业）
- [ ] `GET /api/admin/holidays` - 节假日列表
- [ ] `POST /api/admin/holidays` - 新增节假日

### 模块 2: 场地预约 ⭐ 核心

#### 用户端（需完善）
- [ ] `GET /api/bookings` - 预约列表 ✅ 已实现
- [ ] `POST /api/bookings` - 创建预约 ✅ 已实现
- [ ] `GET /api/bookings/[id]` - 预约详情（完善）
- [ ] `PUT /api/bookings/[id]/cancel` - 取消预约（完善）
- [ ] 多人联机预约功能（TODO）

#### 管理后台（需开发）
- [ ] `GET /api/admin/bookings` - 预约列表（含筛选）
- [ ] `POST /api/admin/bookings` - 手动创建预约
- [ ] `PUT /api/admin/bookings/[id]/confirm` - 确认预约
- [ ] `PUT /api/admin/bookings/[id]/complete` - 完成预约（发积分）
- [ ] `PUT /api/admin/bookings/[id]/no-show` - 标记失约
- [ ] `GET /api/admin/blacklist` - 黑名单列表
- [ ] `POST /api/admin/blacklist` - 添加黑名单

### 模块 3: 预约评价

#### 用户端
- [ ] `POST /api/reviews` ✅ 已实现
- [ ] `GET /api/reviews` ✅ 已实现

#### 管理后台
- [ ] `GET /api/admin/reviews` - 评价列表
- [ ] `DELETE /api/admin/reviews/[id]` - 删除评价

### 模块 4: 意见反馈

#### 用户端
- [ ] `GET /api/feedback` ✅ 已实现
- [ ] `POST /api/feedback` ✅ 已实现

#### 管理后台
- [ ] `GET /api/admin/feedbacks` - 反馈列表
- [ ] `PUT /api/admin/feedbacks/[id]/reply` - 回复反馈

### 模块 5: 数据报表

#### 管理后台
- [ ] `GET /api/admin/stats/revenue` - 营收统计
- [ ] `GET /api/admin/stats/bookings` - 预约统计
- [ ] `GET /api/admin/stats/members` - 会员统计
- [ ] `GET /api/admin/stats/dashboard` - 控制台数据

---

## 开发者 B 详细任务

### 模块 1: 教练管理 ⭐ 优先

#### 用户端（已完成前端，需完善）
- [ ] `GET /api/coaches` - 教练列表 ✅ 已实现
- [ ] `GET /api/coaches/[id]` - 教练详情（完善）
- [ ] `GET /api/coaches/[id]/schedule` - 教练排班（完善）

#### 管理后台（需开发）
- [ ] `GET /api/admin/coaches` - 教练列表
- [ ] `POST /api/admin/coaches` - 新增教练
- [ ] `PUT /api/admin/coaches/[id]` - 编辑教练
- [ ] `DELETE /api/admin/coaches/[id]` - 删除教练
- [ ] `GET /api/admin/coaches/[id]/schedule` - 获取排班
- [ ] `PUT /api/admin/coaches/[id]/schedule` - 设置排班

### 模块 2: 团体课程

#### 用户端
- [ ] `GET /api/courses` ✅ 已实现
- [ ] `GET /api/courses/[id]` - 课程详情（完善）
- [ ] `POST /api/courses/[id]/enroll` - 报名课程（完善）

#### 管理后台
- [ ] `GET /api/admin/courses` - 课程列表
- [ ] `POST /api/admin/courses` - 新增课程
- [ ] `PUT /api/admin/courses/[id]` - 编辑课程
- [ ] `GET /api/admin/courses/[id]/students` - 报名学员

### 模块 3: 会员管理

#### 用户端
- [ ] `GET /api/user` ✅ 已实现
- [ ] `PUT /api/user` - 更新资料（需开发）
- [ ] `POST /api/user/verify` - 实名认证提交（需开发）

#### 管理后台
- [ ] `GET /api/admin/members` - 会员列表
- [ ] `GET /api/admin/members/[id]` - 会员详情
- [ ] `PUT /api/admin/members/[id]/points` - 调整积分
- [ ] `PUT /api/admin/members/[id]/level` - 调整等级
- [ ] `PUT /api/admin/members/[id]/freeze` - 冻结/解冻
- [ ] `GET /api/admin/verifications` - 实名审核列表
- [ ] `PUT /api/admin/verifications/[id]` - 审核实名

### 模块 4: 积分商城

#### 用户端
- [ ] `GET /api/products` ✅ 已实现
- [ ] `POST /api/products/[id]/redeem` - 兑换商品（完善）
- [ ] `GET /api/checkin` ✅ 已实现
- [ ] `POST /api/checkin` ✅ 已实现
- [ ] `GET /api/points/history` ✅ 已实现

#### 管理后台
- [ ] `GET /api/admin/products` - 商品列表
- [ ] `POST /api/admin/products` - 新增商品
- [ ] `PUT /api/admin/products/[id]` - 编辑商品
- [ ] `PUT /api/admin/products/[id]/stock` - 调整库存
- [ ] `GET /api/admin/orders` - 兑换订单列表
- [ ] `PUT /api/admin/orders/[id]/ship` - 发货

### 模块 5: 优惠券

#### 用户端
- [ ] `GET /api/coupons` ✅ 已实现
- [ ] `GET /api/coupons/available` - 可领取优惠券（完善）
- [ ] `POST /api/coupons/claim` - 领取优惠券（完善）

#### 管理后台
- [ ] `GET /api/admin/coupons` - 优惠券模板列表
- [ ] `POST /api/admin/coupons` - 创建优惠券
- [ ] `PUT /api/admin/coupons/[id]` - 编辑优惠券
- [ ] `POST /api/admin/coupons/[id]/send` - 发放优惠券

### 模块 6: 消息/推荐

#### 用户端
- [ ] `GET /api/messages` ✅ 已实现
- [ ] `PUT /api/messages/[id]/read` - 标记已读（完善）
- [ ] `GET /api/referral` ✅ 已实现

#### 管理后台
- [ ] `POST /api/admin/messages/send` - 发送消息/通知

---

## 共享文件约定

| 文件 | 负责人 | 说明 |
|------|--------|------|
| `prisma/schema.prisma` | 各自模块 | 改前先同步代码 |
| `src/lib/constants.ts` | 各自添加 | 按模块分区添加 |
| `src/config/app.config.ts` | 开发者 A | 全局配置 |
| `src/app/(admin)/admin/layout.tsx` | 开发者 A | 后台布局 |
| `src/components/layout/admin-sidebar.tsx` | 开发者 A | 后台侧边栏 |

---

## Git 分支策略

```
main                    # 稳定版本
├── develop             # 开发集成分支
├── feature/venue       # 开发者 A: 场地模块
├── feature/booking     # 开发者 A: 预约模块
├── feature/coach       # 开发者 B: 教练模块
├── feature/member      # 开发者 B: 会员模块
└── ...
```

## 每日同步流程

```bash
# 1. 开始工作前
git checkout develop
git pull origin develop

# 2. 切到自己的分支
git checkout feature/xxx
git merge develop

# 3. 开发完成后
git add .
git commit -m "feat(xxx): 完成xxx功能"
git push origin feature/xxx

# 4. 合并到 develop（或提 PR）
git checkout develop
git merge feature/xxx
git push origin develop
```
